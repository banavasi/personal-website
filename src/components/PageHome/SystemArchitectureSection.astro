---
import { NeoCard } from '@/components/NeoCard';
import { homeContent } from '@/content/home';
import type { AccentColor } from '@/types/content';

interface RuntimeExperience {
  status: string;
  company: string;
  role: string;
  period: string;
  description: string;
  isCurrent: boolean;
}

interface PackageCategory {
  name: string;
  accentColor: AccentColor;
  skills: string[];
}

interface Props {
  content?: {
    title: string;
    runtime: {
      title: string;
      experience: RuntimeExperience[];
    };
    packages: {
      title: string;
      categories: PackageCategory[];
    };
  };
}

const { content } = Astro.props;

// Use props or fallback to static content
const systemArchitecture = content || homeContent.systemArchitecture;
---

<section class="border-t-4 border-black py-12 sm:py-16 lg:py-20 dark:border-white overflow-hidden">
  <div class="container mx-auto px-4">
    <h2 class="font-display mb-8 sm:mb-12 lg:mb-16 text-right text-2xl sm:text-4xl md:text-5xl lg:text-6xl font-bold break-all sm:break-normal">
      {systemArchitecture.title}
    </h2>

    <div class="grid grid-cols-1 gap-8 sm:gap-10 lg:gap-12 lg:grid-cols-2">
      <!-- Runtime Environment (Experience) -->
      <div>
        <h3 class="mb-4 sm:mb-6 lg:mb-8 flex items-center font-mono text-lg sm:text-xl lg:text-2xl font-bold">
          <span class="bg-neon-green mr-3 sm:mr-4 h-3 w-3 sm:h-4 sm:w-4 animate-pulse shrink-0"></span>
          <span class="break-all sm:break-normal">{systemArchitecture.runtime.title}</span>
        </h3>

        <div class="space-y-4 sm:space-y-6">
          {
            systemArchitecture.runtime.experience.map((exp) => (
              <div
                class={`border-2 sm:border-4 ${exp.isCurrent ? 'border-neon-green bg-neon-green/10' : 'border-black dark:border-white'} p-4 sm:p-6 transition-all hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] sm:hover:shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] dark:hover:shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] sm:dark:hover:shadow-[8px_8px_0px_0px_rgba(255,255,255,1)]`}
              >
                <div class="mb-2 sm:mb-3 flex flex-col sm:flex-row sm:items-start sm:justify-between gap-1 sm:gap-2">
                  <div class="font-mono text-xs sm:text-sm font-bold">
                    {exp.isCurrent ? (
                      <span class="text-neon-green flex items-center gap-2">
                        <span class="relative flex h-3 w-3">
                          <span class="bg-neon-green absolute inline-flex h-full w-full animate-ping rounded-full opacity-75" />
                          <span class="bg-neon-green relative inline-flex h-3 w-3 rounded-full" />
                        </span>
                        {exp.status}
                      </span>
                    ) : (
                      <span class="text-gray-500">{exp.status}</span>
                    )}
                  </div>
                  <div class="font-mono text-xs text-gray-500">{exp.period}</div>
                </div>
                <h4 class="font-display mb-1 text-xl sm:text-2xl lg:text-3xl font-bold">{exp.company}</h4>
                <p class="mb-2 sm:mb-3 font-mono text-sm sm:text-base lg:text-lg">{exp.role}</p>
                <p class="font-body text-sm sm:text-base text-gray-600 dark:text-gray-400">{exp.description}</p>
              </div>
            ))
          }
        </div>
      </div>

      <!-- Installed Packages (Skills) -->
      <div>
        <h3 class="mb-4 sm:mb-6 lg:mb-8 flex items-center font-mono text-lg sm:text-xl lg:text-2xl font-bold">
          <span class="bg-alert-red mr-3 sm:mr-4 h-3 w-3 sm:h-4 sm:w-4 shrink-0"></span>
          <span class="break-all sm:break-normal">{systemArchitecture.packages.title}</span>
        </h3>

        <div class="grid grid-cols-1 gap-4 sm:gap-6">
          {
            systemArchitecture.packages.categories.map((category) => {
              const accentColors = {
                green: 'text-neon-green',
                blue: 'text-electric-blue',
                red: 'text-alert-red',
                none: 'text-black dark:text-white',
              };

              const hoverBorders = {
                green: 'hover:border-neon-green',
                blue: 'hover:border-electric-blue',
                red: 'hover:border-alert-red',
                none: 'hover:border-gray-400',
              };

              return (
                <NeoCard
                  client:load
                  className={
                    category.accentColor === 'green'
                      ? 'bg-black text-white dark:bg-white dark:text-black'
                      : ''
                  }
                >
                  <h4
                    class={`font-mono font-bold ${accentColors[category.accentColor]} mb-4 border-b ${category.accentColor === 'green' ? 'border-gray-700 dark:border-gray-300' : 'border-gray-200 dark:border-gray-700'} pb-2`}
                  >
                    {category.name}
                  </h4>
                  <div class="flex flex-wrap gap-2">
                    {category.skills.map((skill) => (
                      <span
                        class={`${category.accentColor === 'green' ? 'bg-white text-black dark:bg-black dark:text-white' : 'bg-gray-100 text-black dark:bg-gray-800 dark:text-white'} border-2 border-transparent px-3 py-1 font-mono text-sm font-bold ${hoverBorders[category.accentColor]} cursor-default transition-colors`}
                      >
                        {skill}
                      </span>
                    ))}
                  </div>
                </NeoCard>
              );
            })
          }
        </div>
      </div>
    </div>
  </div>
</section>
