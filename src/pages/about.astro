---
import MainLayout from "@/layouts/main.astro";
import { Badge } from "@/components/ui/badge";
import { Mail, Linkedin, Github, MapPin, Printer } from "lucide-react";
import { getResumeData } from "@/lib/cms/content-service";

// Fetch content from CMS with fallback to static
const resumeData = await getResumeData();

const content = {
  title: "Shashank Shandilya - Resume | Senior Technical Lead & Solutions Architect",
  description: "Senior Technical Lead with 8+ years experience in AI automation, cloud architecture, and full-stack development. Expertise in Python, TypeScript, AWS, Kubernetes, and leading high-performing engineering teams.",
};

// Structured Data for SEO
const personSchema = {
  "@context": "https://schema.org",
  "@type": "Person",
  "name": resumeData.personal.name,
  "jobTitle": resumeData.personal.title,
  "description": resumeData.personal.bio,
  "url": "https://shashankshandilya.com",
  "sameAs": [
    "https://linkedin.com/in/shashankshandilya",
    "https://github.com/banavasi"
  ],
  "address": {
    "@type": "PostalAddress",
    "addressLocality": "Scottsdale",
    "addressRegion": "AZ",
    "addressCountry": "US"
  },
  "knowsAbout": resumeData.keywords,
  "alumniOf": {
    "@type": "EducationalOrganization",
    "name": "Sri Jayachamarajendra College of Engineering (SJCE), Mysore"
  },
  "hasCredential": {
    "@type": "EducationalOccupationalCredential",
    "credentialCategory": "degree",
    "name": "Master of Computer Applications (MCA)",
    "educationalLevel": "Master's Degree"
  }
};
---

<MainLayout content={content}>
  <!-- Structured Data / JSON-LD for SEO -->
  <script type="application/ld+json" set:html={JSON.stringify(personSchema)} />

  <!-- Print Button - Hidden on mobile and in print -->
  <div class="hidden md:block fixed top-24 right-6 z-50 print:hidden">
    <button
      onclick="window.print()"
      class="flex items-center gap-2 bg-neon-green text-black px-4 py-3 font-mono text-sm font-bold border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] hover:translate-x-[2px] hover:translate-y-[2px] transition-all"
    >
      <Printer className="w-5 h-5" />
      PRINT
    </button>
  </div>

  <!-- Resume Container - Single Page Layout -->
  <div class="min-h-screen bg-concrete dark:bg-zinc-900 py-12 px-4 print:p-0 print:bg-white">
    <div class="max-w-5xl mx-auto bg-white dark:bg-black border-8 border-black dark:border-white shadow-[16px_16px_0px_0px_rgba(0,0,0,1)] dark:shadow-[16px_16px_0px_0px_rgba(255,255,255,1)] print:border-4 print:shadow-none print:max-w-none">
      
      <!-- Header Section -->
      <div class="border-b-8 border-black dark:border-white p-8 bg-neon-green print:border-b-4 print:p-6 print:bg-white">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-center print:grid-cols-3">
          <!-- Profile Image -->
          <div class="flex justify-center md:justify-start">
            <div class="w-48 h-48 border-8 border-black rounded-full overflow-hidden shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] print:w-32 print:h-32 print:border-4 print:shadow-none">
              <img 
                src={resumeData.personal.image} 
                alt={resumeData.personal.name}
                class="w-full h-full object-cover scale-110"
              />
            </div>
          </div>

          <!-- Name and Title -->
          <div class="md:col-span-2 text-center md:text-left">
            <h1 class="font-display font-black text-5xl mb-2 text-black print:text-3xl">
              {resumeData.personal.name}
            </h1>
            <p class="font-mono text-lg mb-4 text-black print:text-base">
              {resumeData.personal.title}
            </p>
            <p class="font-body text-sm text-black/80 mb-6 print:text-xs">
              {resumeData.personal.bio}
            </p>

            <!-- Contact Info -->
            <div class="flex flex-wrap gap-3 justify-center md:justify-start print:gap-2">
              {resumeData.personal.contact.map((contact) => {
                const icons = { Mail, Linkedin, Github, MapPin };
                const Icon = icons[contact.icon as keyof typeof icons];
                return (
                  contact.href ? (
                    <a
                      href={contact.href}
                      target={contact.href.startsWith('http') ? '_blank' : undefined}
                      rel={contact.href.startsWith('http') ? 'noopener noreferrer' : undefined}
                      class="inline-flex items-center gap-2 bg-black text-neon-green px-3 py-1.5 font-mono text-xs font-bold border-2 border-black hover:bg-black/90 transition-colors print:bg-white print:text-black print:border print:gap-1 print:px-2 print:py-1"
                    >
                      <Icon className="w-4 h-4" />
                      {contact.value}
                    </a>
                  ) : (
                    <span class="inline-flex items-center gap-2 bg-black text-white px-3 py-1.5 font-mono text-xs font-bold border-2 border-black print:bg-white print:text-black print:border print:gap-1 print:px-2 print:py-1">
                      <Icon className="w-4 h-4" />
                      {contact.value}
                    </span>
                  )
                );
              })}
            </div>
          </div>
        </div>
      </div>

      <!-- Two Column Layout -->
      <div class="grid grid-cols-1 md:grid-cols-3 min-h-[600px] print:grid-cols-3 print:min-h-0">
        
        <!-- Left Column - Main Content -->
        <div class="md:col-span-2 p-8 border-r-8 border-black dark:border-white print:p-6 print:border-r-4">
          
          <!-- Experience Section -->
          <div class="mb-8">
            <h2 class="font-display font-black text-3xl mb-6 bg-neon-green inline-block px-4 py-2 border-4 border-black print:text-2xl print:bg-white print:border-b-4 print:border-l-0 print:border-r-0 print:border-t-0 print:px-0 print:mb-4">
              EXPERIENCE
            </h2>
            
            <div class="space-y-6 mt-6">
              {resumeData.experience.map((job, index) => (
                <div class="relative pl-8 border-l-4 border-black dark:border-white">
                  <div class="absolute -left-[9px] top-1 w-4 h-4 bg-neon-green border-2 border-black dark:border-white"></div>
                  
                  <div class="mb-2">
                    <span class="font-mono text-xs font-bold text-neon-green bg-black px-2 py-0.5">
                      {job.period}
                    </span>
                  </div>
                  
                  <h3 class="font-display font-bold text-2xl mb-1">
                    {job.title}
                  </h3>
                  <p class="font-mono text-sm mb-1">
                    {job.company} • {job.location} • {job.type}
                  </p>
                  
                  <ul class="mt-3 space-y-2">
                    {job.highlights.map((highlight) => (
                      <li class="font-body text-sm flex items-start gap-2">
                        <span class="text-neon-green font-bold">●</span>
                        <span>{highlight}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              ))}
            </div>
          </div>

          <!-- Education Section -->
          <div>
            <h2 class="font-display font-black text-3xl mb-6 bg-electric-blue inline-block px-4 py-2 border-4 border-black print:text-2xl print:bg-white print:border-b-4 print:border-l-0 print:border-r-0 print:border-t-0 print:px-0 print:mb-4">
              EDUCATION
            </h2>
            
            <div class="space-y-4 mt-6">
              {resumeData.education.map((edu) => (
                <div class="border-4 border-black dark:border-white p-4 bg-electric-blue/10">
                  <span class="font-mono text-xs font-bold text-electric-blue bg-black px-2 py-0.5">
                    {edu.period}
                  </span>
                  <h3 class="font-display font-bold text-xl mt-2">
                    {edu.degree}
                  </h3>
                  <p class="font-mono text-sm mb-2">{edu.institution}</p>
                  {edu.gpa && (
                    <p class="font-mono text-sm font-bold text-electric-blue mb-2">
                      {edu.gpa}
                    </p>
                  )}
                  {edu.achievements && (
                    <ul class="mt-3 space-y-1">
                      {edu.achievements.map((achievement: string) => (
                        <li class="font-body text-xs flex items-start gap-2">
                          <span class="text-electric-blue font-bold">▸</span>
                          <span>{achievement}</span>
                        </li>
                      ))}
                    </ul>
                  )}
                </div>
              ))}

              {resumeData.certifications.map((cert) => (
                <div class="border-4 border-black dark:border-white p-4 bg-neon-green/10">
                  <span class="font-mono text-xs font-bold text-neon-green bg-black px-2 py-0.5">
                    {cert.date}
                  </span>
                  <h3 class="font-display font-bold text-xl mt-2">
                    {cert.title}
                  </h3>
                  <p class="font-mono text-sm mb-1">{cert.issuer}</p>
                  {cert.description && (
                    <p class="font-body text-xs text-gray-600 dark:text-gray-400 mt-2">
                      {cert.description}
                    </p>
                  )}
                  {cert.credential && cert.credential !== "In Progress" && (
                    <p class="font-mono text-xs text-gray-600 dark:text-gray-400 mt-1">
                      Credential ID: {cert.credential}
                    </p>
                  )}
                </div>
              ))}
            </div>
          </div>
        </div>

        <!-- Right Column - Key Info & Skills -->
        <div class="p-8 bg-concrete dark:bg-zinc-800 print:p-6 print:bg-white">
          
          <!-- Key Achievements -->
          <div class="mb-8">
            <h3 class="font-display font-black text-2xl mb-4 bg-neon-green inline-block px-3 py-1 border-4 border-black text-sm print:bg-white print:border-b-4 print:border-l-0 print:border-r-0 print:border-t-0">
              KEY ACHIEVEMENTS
            </h3>
            <div class="space-y-3 mt-4">
              {resumeData.achievements.map((achievement, index) => {
                const colors = ['neon-green', 'electric-blue', 'alert-red'];
                const bgColor = colors[index % 3];
                return (
                  <div class={`border-4 border-black dark:border-white bg-${bgColor}/10 p-4 hover:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] dark:hover:shadow-[4px_4px_0px_0px_rgba(255,255,255,1)] transition-all print:border-2`}>
                    <div class={`font-display font-black text-2xl mb-1 text-${bgColor}`}>
                      {achievement.value}
                    </div>
                    <div class="font-mono text-xs font-bold uppercase">
                      {achievement.label}
                    </div>
                  </div>
                );
              })}
            </div>
          </div>

          <!-- Core Expertise -->
          <div class="mb-8">
            <h3 class="font-display font-black text-2xl mb-4 bg-electric-blue inline-block px-3 py-1 border-4 border-black text-sm print:bg-white print:border-b-4 print:border-l-0 print:border-r-0 print:border-t-0">
              CORE EXPERTISE
            </h3>
            <div class="space-y-4 mt-4">
              {resumeData.expertise.map((area) => (
                <div class="border-4 border-black dark:border-white p-4 bg-white dark:bg-black print:border-2">
                  <h4 class="font-mono text-sm font-bold mb-2 text-electric-blue">
                    {area.title}
                  </h4>
                  <div class="space-y-1">
                    {area.items.map((item) => (
                      <div class="font-mono text-xs flex items-start gap-2">
                        <span class="text-electric-blue">▸</span>
                        <span>{item}</span>
                      </div>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          </div>

          <!-- Skills -->
          <div>
            <h3 class="font-display font-black text-2xl mb-4 bg-alert-red inline-block px-3 py-1 border-4 border-black text-sm print:bg-white print:border-b-4 print:border-l-0 print:border-r-0 print:border-t-0">
              TECHNICAL SKILLS
            </h3>
            
            <div class="space-y-4 mt-4">
              <div>
                <h4 class="font-mono text-xs font-bold mb-2 text-neon-green">
                  LANGUAGES
                </h4>
                <div class="flex flex-wrap gap-2">
                  {resumeData.skills.languages.map((skill) => (
                    <Badge className="font-mono text-xs border-2 border-black bg-black text-white">
                      {skill}
                    </Badge>
                  ))}
                </div>
              </div>

              <div>
                <h4 class="font-mono text-xs font-bold mb-2 text-electric-blue">
                  INFRASTRUCTURE
                </h4>
                <div class="flex flex-wrap gap-2">
                  {resumeData.skills.infrastructure.map((skill) => (
                    <Badge className="font-mono text-xs border-2 border-black bg-white text-black dark:bg-black dark:text-white">
                      {skill}
                    </Badge>
                  ))}
                </div>
              </div>

              <div>
                <h4 class="font-mono text-xs font-bold mb-2 text-alert-red">
                  DATA & AI
                </h4>
                <div class="flex flex-wrap gap-2">
                  {resumeData.skills.dataAI.map((skill) => (
                    <Badge className="font-mono text-xs border-2 border-black bg-white text-black dark:bg-black dark:text-white">
                      {skill}
                    </Badge>
                  ))}
                </div>
              </div>

              <div>
                <h4 class="font-mono text-xs font-bold mb-2">
                  FRAMEWORKS
                </h4>
                <div class="flex flex-wrap gap-2">
                  {resumeData.skills.frameworks.map((skill) => (
                    <Badge className="font-mono text-xs border-2 border-black bg-white text-black dark:bg-black dark:text-white">
                      {skill}
                    </Badge>
                  ))}
                </div>
              </div>

              <div>
                <h4 class="font-mono text-xs font-bold mb-2 text-neon-green">
                  DEVOPS
                </h4>
                <div class="flex flex-wrap gap-2">
                  {resumeData.skills.devops.map((skill) => (
                    <Badge className="font-mono text-xs border-2 border-black bg-white text-black dark:bg-black dark:text-white">
                      {skill}
                    </Badge>
                  ))}
                </div>
              </div>

              <div>
                <h4 class="font-mono text-xs font-bold mb-2 text-electric-blue">
                  ARCHITECTURE
                </h4>
                <div class="flex flex-wrap gap-2">
                  {resumeData.skills.architecture.map((skill) => (
                    <Badge className="font-mono text-xs border-2 border-black bg-white text-black dark:bg-black dark:text-white">
                      {skill}
                    </Badge>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SEO Keywords Section (Hidden visually, visible to ATS/Search engines) -->
      <div class="sr-only print:hidden" aria-hidden="true">
        <h2>Professional Keywords and Expertise</h2>
        <p>
          {resumeData.keywords.join(", ")}
        </p>
        <p>
          Experienced in building scalable cloud-native applications, AI-powered automation systems, 
          microservices architecture, and leading distributed engineering teams. Proven track record 
          in reducing operational costs, improving system performance, and delivering enterprise-grade 
          solutions. Expert in full-stack development, DevOps practices, and agile methodologies.
        </p>
      </div>
    </div>
  </div>
</MainLayout>

<style>
  @media print {
    @page {
      margin: 0.5in;
      size: letter;
    }
    
    body {
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }
    
    /* Ensure proper page breaks */
    .grid {
      page-break-inside: avoid;
    }
    
    /* Scale down text slightly for better fit */
    h1 { font-size: 2rem !important; }
    h2 { font-size: 1.5rem !important; }
    h3 { font-size: 1.25rem !important; }
    
    /* Remove shadows and thick borders for print */
    * {
      box-shadow: none !important;
    }
    
    /* Ensure backgrounds print */
    .bg-neon-green,
    .bg-electric-blue,
    .bg-alert-red {
      background-color: white !important;
    }
  }
</style>
